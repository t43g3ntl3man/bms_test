!function(u,c,f){if("function"!=typeof c)return console.error("nette.ajax.js: jQuery is missing, load it please");c.nette=new(c.extend(function(){var o={self:this,initialized:!1,contexts:{},on:{init:{},load:{},prepare:{},before:{},start:{},success:{},complete:{},error:{}},fire:function(){var n=!0,i=Array.prototype.slice.call(arguments),t=i.shift(),e="string"==typeof t?t:t.name,r="object"==typeof t&&t.off||{};return i.push(o.self),c.each(o.on[e],function(t,e){if(e===f||-1!==c.inArray(t,r))return!0;e=e.apply(o.contexts[t],i);return n=e===f||e}),n},requestHandler:function(t){t=o.self.ajax({},this,t);if(t&&t._returnFalse)return!1},ext:function(t,e,n){for(;!n;)n="ext_"+Math.random(),o.contexts[n]&&(n=f);c.each(t,function(t,e){o.on[t][n]=e}),o.contexts[n]=c.extend(e||{},{name:function(){return n},ext:function(t,e){var n=o.contexts[t];if(!n&&e)throw"Extension '"+this.name()+"' depends on disabled extension '"+t+"'.";return n}})}};this.ext=function(n,t,e){if("object"==typeof n)o.ext(n,t);else{if(t===f)return o.contexts[n];if(t){if("string"==typeof n&&o.contexts[n]!==f)throw"Cannot override already registered nette-ajax extension '"+n+"'.";o.ext(t,e,n)}else c.each(["init","load","prepare","before","start","success","complete","error"],function(t,e){o.on[e][n]=f}),o.contexts[n]=f}return this},this.init=function(t,e){if(o.initialized)throw"Cannot initialize nette-ajax twice.";if("function"==typeof t)this.ext("init",null),this.ext("init",{load:t},e);else if("object"==typeof t)this.ext("init",null),this.ext("init",t,e);else if(t!==f)throw"Argument of init() can be function or function-hash only.";return o.initialized=!0,o.fire("init"),this.load(),this},this.load=function(){return o.fire("load",o.requestHandler),this},this.ajax=function(t,e,n){var i,r;return!(t="string"===c.type(t)?{url:t}:t).nette&&e&&n&&(i=c(e),(n=t.nette={e:n,ui:e,el:i,isForm:i.is("form"),isSubmit:i.is("input[type=submit]")||i.is("button[type=submit]"),isImage:i.is("input[type=image]"),form:null}).isSubmit||n.isImage?n.form=n.el.closest("form"):n.isForm&&(n.form=n.el),t.url||(t.url=n.form?n.form.attr("action")||u.location.pathname+u.location.search:e.href),t.type||(t.type=n.form?n.form.attr("method"):"get"),i.is("[data-ajax-off]")&&(0===(e=i.attr("data-ajax-off")).indexOf("[")?t.off=i.data("ajaxOff"):-1!==e.indexOf(",")?t.off=e.split(","):-1!==e.indexOf(" ")?t.off=e.split(" "):t.off=e,"string"==typeof t.off&&(t.off=[t.off]),t.off=c.grep(c.each(t.off,function(t){return c.trim(t)}),function(t){return t.length}))),o.fire({name:"prepare",off:t.off||{}},t),t.prepare&&t.prepare(t),r=t.beforeSend,t.beforeSend=function(t,e){var n=o.fire({name:"before",off:e.off||{}},t,e);return n=(n||n===f)&&r?r(t,e):n},this.handleXHR(c.ajax(t),t)},this.handleXHR=function(t,i){return i=i||{},!t||void 0!==t.statusText&&"canceled"===t.statusText||(t.done(function(t,e,n){o.fire({name:"success",off:i.off||{}},t,e,n,i)}).fail(function(t,e,n){o.fire({name:"error",off:i.off||{}},t,e,n,i)}).always(function(t,e){o.fire({name:"complete",off:i.off||{}},t,e,i)}),o.fire({name:"start",off:i.off||{}},t,i),i.start&&i.start(t,i)),t}},c.nette||{})),c.fn.netteAjax=function(t,e){return c.nette.ajax(e||{},this[0],t)},c.fn.netteAjaxOff=function(){return this.off(".nette")},c.nette.ext("validation",{before:function(t,e){if(!e.nette)return!0;var n=e.nette,i=n.e,r=c.extend(this.defaults,e.validate||function(){var t;if(n.el.is("[data-ajax-validate]"))return t=n.el.data("ajaxValidate"),!1===t?{keys:!1,url:!1,form:!1}:"object"==typeof t?t:void 0}()||{}),o=!1;if(n.el.attr("data-ajax-pass")!==f&&(o="bool"!=typeof(o=n.el.data("ajaxPass"))||o),r.keys){var a=i.button||i.ctrlKey||i.shiftKey||i.altKey||i.metaKey;if(n.form){if(a&&n.isSubmit)return!(this.explicitNoAjax=!0);if(n.isForm&&this.explicitNoAjax)return this.explicitNoAjax=!1}else if(a)return!1}if(r.form&&n.form&&((n.isSubmit||n.isImage)&&(n.form.get(0)["nette-submittedBy"]=n.el.get(0)),void 0===Nette.version||"2.3"==Nette.version?(a=this.ie(),n.form.get(0).onsubmit&&!1===n.form.get(0).onsubmit(void 0!==a&&a<9?f:i)):!1===(n.form.get(0).onsubmit?n.form.triggerHandler("submit"):Nette.validateForm(n.form.get(0)))))return i.stopImmediatePropagation(),i.preventDefault(),!1;if(r.url){a=n.form?e.url:n.el.attr("href");if(/(?:^[a-z][a-z0-9+.-]*:|\/\/)/.test(a)){r=new URL(a);if(/:|^#/.test(r.pathname+r.search+r.hash))return!1}else if(/:|^#/.test(a))return!1}return o||(i.stopPropagation(),i.preventDefault(),t._returnFalse=!0),!0}},{defaults:{keys:!0,url:!0,form:!0},explicitNoAjax:!1,ie:function(t){for(var e=3,n=document.createElement("div"),i=n.getElementsByTagName("i");n.innerHTML="\x3c!--[if gt IE "+ ++e+"]><i></i><![endif]--\x3e",i[0];);return 4<e?e:t}}),c.nette.ext("forms",{init:function(){var t;u.Nette&&(t=this.ext("snippets"))&&t.after(function(t){t.find("form").each(function(){u.Nette.initForm(this)})})},prepare:function(t){var e=t.nette;if(e&&e.form){var n,i=e.e,r=t.data||{},o={},a=(e.isSubmit?o[e.el.attr("name")]=e.el.val()||"":e.isImage&&(a=e.el.offset(),n=e.el.attr("name"),i=[Math.max(0,i.pageX-a.left),Math.max(0,i.pageY-a.top)],-1!==n.indexOf("[",0)?o[n]=i:(o[n+".x"]=i[0],o[n+".y"]=i[1])),e.form.attr("method"));if(a&&"post"===a.toLowerCase()&&"FormData"in u){var f=new FormData(e.form[0]);for(s in o)f.append(s,o[s]);if("string"!=typeof r)for(var s in r)f.append(s,r[s]);t.data=f,t.processData=!1,t.contentType=!1}else"string"!=typeof r&&(r=c.param(r)),o=c.param(o),t.data=e.form.serialize()+(o?"&"+o:"")+"&"+r}}}),c.nette.ext("snippets",{success:function(t){t.snippets&&this.updateSnippets(t.snippets)}},{beforeQueue:c.Callbacks(),afterQueue:c.Callbacks(),completeQueue:c.Callbacks(),before:function(t){this.beforeQueue.add(t)},after:function(t){this.afterQueue.add(t)},complete:function(t){this.completeQueue.add(t)},updateSnippets:function(t,e){var n,i=this,r=[];for(n in t){var o=this.getElement(n);o.get(0)&&r.push(o.get(0)),this.updateSnippet(o,t[n],e)}c(r).promise().done(function(){i.completeQueue.fire()})},updateSnippet:function(t,e,n){t.is("title")?document.title=e:(this.beforeQueue.fire(t),this.applySnippet(t,e,n),this.afterQueue.fire(t))},getElement:function(t){return c("#"+this.escapeSelector(t))},applySnippet:function(t,e,n){!n&&t.is("[data-ajax-append]")?t.append(e):!n&&t.is("[data-ajax-prepend]")?t.prepend(e):t.html()==e&&!/<[^>]*script/.test(e)||t.html(e)},escapeSelector:function(t){return t.replace(/[\!"#\$%&'\(\)\*\+,\.\/:;<=>\?@\[\\\]\^`\{\|\}~]/g,"\\$&")}}),c.nette.ext("redirect",{success:function(t){if(t.redirect)return u.location.href=t.redirect,!1}}),c.nette.ext("state",{success:function(t){t.state&&(this.state=t.state)}},{state:null}),c.nette.ext("unique",{start:function(t){this.xhr&&this.xhr.abort(),this.xhr=t},complete:function(){this.xhr=null}},{xhr:null}),c.nette.ext("abort",{init:function(){c("body").keydown(c.proxy(function(t){this.xhr&&"27"===t.keyCode.toString()&&!(t.ctrlKey||t.shiftKey||t.altKey||t.metaKey)&&this.xhr.abort()},this))},start:function(t){this.xhr=t},complete:function(){this.xhr=null}},{xhr:null}),c.nette.ext("load",{success:function(){c.nette.load()}}),c.nette.ext("init",{load:function(t){c(this.linkSelector).off("click.nette",t).on("click.nette",t),c(this.formSelector).off("submit.nette",t).on("submit.nette",t).off("click.nette",":image",t).on("click.nette",":image",t).off("click.nette",":submit",t).on("click.nette",":submit",t),c(this.buttonSelector).closest("form").off("click.nette",this.buttonSelector,t).on("click.nette",this.buttonSelector,t)}},{linkSelector:"a.ajax",formSelector:"form.ajax",buttonSelector:'input.ajax[type="submit"], button.ajax[type="submit"], input.ajax[type="image"]'})}(window,window.jQuery);
//# sourceMappingURL=nette.ajax.js.map
